/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, {
/******/ 				configurable: false,
/******/ 				enumerable: true,
/******/ 				get: getter
/******/ 			});
/******/ 		}
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
Object.defineProperty(__webpack_exports__, "__esModule", { value: true });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__css_css_css__ = __webpack_require__(1);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__css_css_css___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0__css_css_css__);
/**
 * Created by sanchez 
 */

// import CSS
// import animate_css from 'animate.css/animate.min.css';

// import scss from '../css/sass.scss';


// require('aframe');
// require('t')
// window.Detector = require('./entities/Detector');
// require('./entities/CanvasRenderer');
// require('./entities/Projector');
// require('jquery.valiant360');
// import Js Plugins/Entities

//ES6 Module
// import Bar1 from './entities/Bar1';
// import Howler from 'howler';
// //CommonJS
// var Bar2=require('./entities/Bar2');

if (/Mobile/i.test(navigator.userAgent)) {
    window.isMobile = true;
} else {
    window.isMobile = false;
}


window.h5 = {
    initThree360: function() {
        var camera, scene, renderer;
        var texture_placeholder,
            isUserInteracting = false,
            onMouseDownMouseX = 0,
            onMouseDownMouseY = 0,
            lon = 0,
            onMouseDownLon = 0,
            lat = 0,
            onMouseDownLat = 0,
            phi = 0,
            theta = 0,
            distance = 500,
            onPointerDownPointerX = 0,
            onPointerDownPointerY = 0,
            onPointerDownLon = 0,
            onPointerDownLat = 0;
        init();
        // animate();

        function init() {
            var container, mesh;
            window.loaded = false;
            container = document.getElementById('container');
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 1100);
            camera.target = new THREE.Vector3(0, 0, 0);
            scene = new THREE.Scene();
            var geometry = new THREE.SphereBufferGeometry(500, 60, 40);
            // invert the geometry on the x-axis so that all of the faces point inward
            geometry.scale(-1, 1, 1);
            var play_btn = document.getElementById('play_btn');
            var video = document.createElement('video');
            video.width = 640;
            video.height = 360;
            video.loop = true;
            // video.muted = true;

            // video.src = 'http://flimshaw.github.io/Valiant360/videos/overpass-2k.mp4';
            video.src='./assets/media/surf1.mp4';
            video.setAttribute('webkit-playsinline', 'webkit-playsinline');
            video.setAttribute('playsinline', 'playsinline');
            video.setAttribute('x5-video-player-fullscreen', 'false');
            video.setAttribute('x5-video-player-type', 'h5');
            video.setAttribute('x-webkit-airplay', 'true');
            video.crossOrigin = "Anonymous";


            // play_btn.innerHTML = 'Play';
            var texture = new THREE.VideoTexture(video);
            texture.minFilter = THREE.LinearFilter;
            texture.format = THREE.RGBFormat;
            var material = new THREE.MeshBasicMaterial({ map: texture });
            mesh = new THREE.Mesh(geometry, material);
            scene.add(mesh);
            renderer = new THREE.WebGLRenderer();
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            container.appendChild(renderer.domElement);
            animate();


            play_btn.addEventListener('click', function() {
                play_btn.innerHTML = 'Play';
                if (!window.loaded) {
                    // video.pause();
                    window.loaded = true;
                } else {
                    video.play();
                    play_btn.style.display = 'none';
                }
            }, true);
            var eventstart, eventmove, eventstart;

            document.addEventListener('touchstart', function(e) {}, false);
            document.addEventListener('touchmove', function(e) {
                e.preventDefault();
            }, false);

            container.addEventListener('touchstart', onDocumenTouchDown, false);
            container.addEventListener('touchmove', onDocumentTouchMove, false);
            container.addEventListener('touchend', onDocumentTouchUp, false);

            container.addEventListener('mousedown', onDocumentMouseDown, false);
            container.addEventListener('mousemove', onDocumentMouseMove, false);
            container.addEventListener('mouseup', onDocumentMouseUp, false);


            window.addEventListener('resize', onWindowResize, false);
        }

        function onWindowResize() {
            if (/Mobile/i.test(navigator.userAgent)) {
                window.isMobile = true;
            } else {
                window.isMobile = false;
            }
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }


        function onDocumentMouseDown(event) {
            event.preventDefault();
            isUserInteracting = true;
            onPointerDownPointerX = event.clientX;
            onPointerDownPointerY = event.clientY;
            onPointerDownLon = lon;
            onPointerDownLat = lat;
        }

        function onDocumentMouseMove(event) {

            if (isUserInteracting === true) {
                lon = (onPointerDownPointerX - event.clientX) * 0.5 + onPointerDownLon;
                lat = (event.clientY - onPointerDownPointerY) * 0.5 + onPointerDownLat;

            }
        }

        function onDocumentMouseUp(event) {
            isUserInteracting = false;
        }

        function onDocumenTouchDown(event) {
            event.preventDefault();
            isUserInteracting = true;
            onPointerDownPointerX = event.touches[0].clientX;
            onPointerDownPointerY = event.touches[0].clientY;
            onPointerDownLon = lon;
            onPointerDownLat = lat;
        }

        function onDocumentTouchMove(event) {

            if (isUserInteracting === true) {
                lon = (onPointerDownPointerX - event.touches[0].clientX) * 0.5 + onPointerDownLon;
                lat = (event.touches[0].clientY - onPointerDownPointerY) * 0.5 + onPointerDownLat;

            }
        }

        function onDocumentTouchUp(event) {
            isUserInteracting = false;
        }

        function animate() {
            requestAnimationFrame(animate);
            update();
        }

        function update() {
            lat = Math.max(-85, Math.min(85, lat));
            phi = THREE.Math.degToRad(90 - lat);
            theta = THREE.Math.degToRad(lon);
            camera.position.x = distance * Math.sin(phi) * Math.cos(theta);
            camera.position.y = distance * Math.cos(phi);
            camera.position.z = distance * Math.sin(phi) * Math.sin(theta);
            camera.lookAt(camera.target);
            /*
            // distortion
            camera.position.copy( camera.target ).negate();
            */
            renderer.render(scene, camera);
        }

    },
    initValiant360: function() {
        var play_btn = document.getElementById('play_btn');
        $('.valiantContainer').Valiant360();
        play_btn.addEventListener('click', function() {
            // play
            $('.valiantContainer').Valiant360('play');
            $('.valiantContainer').Valiant360('pause');
        }, false);
        $('.valiantContainer').Valiant360('loadVideo', './assets/media/city.mp4');
        $('.valiantContainer').Valiant360('play');
        // $('.valiantContainer').Valiant360('pause');

    },
    rootResize2: function() {
        //orientation landscape width=1334px
        var wFsize;
        var wWidth = (screen.width > 0) ? (window.innerWidth >= screen.width || window.innerWidth == 0) ? screen.width :
            window.innerWidth : window.innerWidth;
        var wHeight = (screen.height > 0) ? (window.innerHeight >= screen.height || window.innerHeight == 0) ?
            screen.height : window.innerHeight : window.innerHeight;
        if (wWidth > wHeight) {
            wHeight = wWidth;
        }
        wFsize = wHeight / 13.34;
        document.getElementsByTagName('html')[0].style.fontSize = wFsize + 'px';
    },
    rootResize1: function() {
        //orientation landscape width=1334px
        var that = this;
        var Dpr = 1,
            uAgent = window.navigator.userAgent;
        var isIOS = uAgent.match(/iphone/i);
        var isYIXIN = uAgent.match(/yixin/i);
        var is2345 = uAgent.match(/Mb2345/i);
        var ishaosou = uAgent.match(/mso_app/i);
        var isSogou = uAgent.match(/sogoumobilebrowser/ig);
        var isLiebao = uAgent.match(/liebaofast/i);
        var isGnbr = uAgent.match(/GNBR/i);
        var isWeixin = uAgent.match(/MicroMessenger/i);
        var wFsize;
        var wWidth = (screen.width > 0) ? (window.innerWidth >= screen.width || window.innerWidth == 0) ? screen.width :
            window.innerWidth : window.innerWidth;
        var wHeight = (screen.height > 0) ? (window.innerHeight >= screen.height || window.innerHeight == 0) ?
            screen.height : window.innerHeight : window.innerHeight;
        if (isIOS) {
            wWidth = screen.width;
            wHeight = screen.height;
        }
        if (wWidth > wHeight) {
            wHeight = wWidth;
        }
        wFsize = wHeight / 13.34;
        if (isYIXIN || is2345 || ishaosou || isSogou || isLiebao || isGnbr || isWeixin) { //YIXIN 和 2345 这里有个刚调用系统浏览器时候的bug，需要一点延迟来获取
            setTimeout(function() {
                wHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
                wWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
                if (wWidth > wHeight) {
                    wHeight = wWidth;
                }
                wFsize = wHeight / 13.34;
                // wFsize = wFsize > 32 ? wFsize : 32;
                document.getElementsByTagName('html')[0].style.fontSize = wFsize + 'px';
            }, 500);
        } else {
            document.getElementsByTagName('html')[0].style.fontSize = wFsize + 'px';
        }

        return that;

    },
    eventInit: function() {
        var that = this;
        document.addEventListener('touchstart', function(e) {}, false);
        document.addEventListener('touchmove', function(e) {
            e.preventDefault();
        }, false);
        return that;
    },
    cssInit: function() {
        var that = this;
        /*
        that.rootResize1();
        window.addEventListener("onorientationchange" in window ? "orientationchange" : "resize", function() {
            if (window.orientation == 90 || window.orientation == -90) {
                //横屏
                //_.renderShuping();
                that.rootResize();
            } else {
                //竖屏
                //_.closeShuping();
            }
        }, false);
        */
        var noChangeCountToEnd = 100,
            noEndTimeout = 1000;
        that.rootResize2();
        window.addEventListener("onorientationchange" in window ? "orientationchange" : "resize", function() {
            var interval,
                timeout,
                end,
                lastInnerWidth,
                lastInnerHeight,
                noChangeCount;
            end = function() {
                // "orientationchangeend"
                clearInterval(interval);
                clearTimeout(timeout);
                interval = null;
                timeout = null;
                that.rootResize1();
            };
            interval = setInterval(function() {
                if (window.innerWidth === lastInnerWidth && window.innerHeight === lastInnerHeight) {
                    noChangeCount++;
                    if (noChangeCount === noChangeCountToEnd) {
                        // The interval resolved the issue first.
                        end();
                    }
                } else {
                    lastInnerWidth = window.innerWidth;
                    lastInnerHeight = window.innerHeight;
                    noChangeCount = 0;
                }
            });
            timeout = setTimeout(function() {
                // The timeout happened first.
                end();
            }, noEndTimeout);
        });

        return that;
    }
};
window.h5.initThree360();
// window.h5.initValiant360();
// window.h5.cssInit().eventInit();


function showStats() {
    var stats = new Stats();
    stats.showPanel(0); // 0: fps, 1: ms, 2: mb, 3+: custom
    var fs = document.createElement('div');
    fs.style.position = 'absolute';
    fs.style.left = 0;
    fs.style.top = 0;
    fs.style.zIndex = 999;
    fs.appendChild(stats.domElement);
    document.body.appendChild(fs);

    function animate() {
        stats.begin();
        // monitored code goes here
        stats.end();
        requestAnimationFrame(animate);
    }
    requestAnimationFrame(animate);
}
showStats();

/***/ }),
/* 1 */
/***/ (function(module, exports) {

// removed by extract-text-webpack-plugin

/***/ })
/******/ ]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAgYWNmMzE2Nzk3MTNmODJlZGQyMzUiLCJ3ZWJwYWNrOi8vLy4vc3JjL2Fzc2V0cy9qcy9tYWluLmpzIiwid2VicGFjazovLy8uL3NyYy9hc3NldHMvY3NzL2Nzcy5jc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOzs7QUFHQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBMkIsMEJBQTBCLEVBQUU7QUFDdkQseUNBQWlDLGVBQWU7QUFDaEQ7QUFDQTtBQUNBOztBQUVBO0FBQ0EsOERBQXNELCtEQUErRDs7QUFFckg7QUFDQTs7QUFFQTtBQUNBOzs7Ozs7Ozs7QUM3REE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0RBQXdELGVBQWU7QUFDdkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiOztBQUVBLGtFQUFrRTtBQUNsRTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOzs7QUFHQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTs7QUFFQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5RkFBeUY7QUFDekY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBOztBQUVBOztBQUVBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsOERBQThEO0FBQzlEO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWTs7Ozs7O0FDcFdBLHlDIiwiZmlsZSI6ImFzc2V0cy9qcy9tYWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwge1xuIFx0XHRcdFx0Y29uZmlndXJhYmxlOiBmYWxzZSxcbiBcdFx0XHRcdGVudW1lcmFibGU6IHRydWUsXG4gXHRcdFx0XHRnZXQ6IGdldHRlclxuIFx0XHRcdH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDApO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHdlYnBhY2svYm9vdHN0cmFwIGFjZjMxNjc5NzEzZjgyZWRkMjM1IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHNhbmNoZXogXG4gKi9cbid1c2Ugc3RyaWN0Jztcbi8vIGltcG9ydCBDU1Ncbi8vIGltcG9ydCBhbmltYXRlX2NzcyBmcm9tICdhbmltYXRlLmNzcy9hbmltYXRlLm1pbi5jc3MnO1xuaW1wb3J0IGNzcyBmcm9tICcuLi9jc3MvY3NzLmNzcyc7XG4vLyBpbXBvcnQgc2NzcyBmcm9tICcuLi9jc3Mvc2Fzcy5zY3NzJztcblxuXG4vLyByZXF1aXJlKCdhZnJhbWUnKTtcbi8vIHJlcXVpcmUoJ3QnKVxuLy8gd2luZG93LkRldGVjdG9yID0gcmVxdWlyZSgnLi9lbnRpdGllcy9EZXRlY3RvcicpO1xuLy8gcmVxdWlyZSgnLi9lbnRpdGllcy9DYW52YXNSZW5kZXJlcicpO1xuLy8gcmVxdWlyZSgnLi9lbnRpdGllcy9Qcm9qZWN0b3InKTtcbi8vIHJlcXVpcmUoJ2pxdWVyeS52YWxpYW50MzYwJyk7XG4vLyBpbXBvcnQgSnMgUGx1Z2lucy9FbnRpdGllc1xuXG4vL0VTNiBNb2R1bGVcbi8vIGltcG9ydCBCYXIxIGZyb20gJy4vZW50aXRpZXMvQmFyMSc7XG4vLyBpbXBvcnQgSG93bGVyIGZyb20gJ2hvd2xlcic7XG4vLyAvL0NvbW1vbkpTXG4vLyB2YXIgQmFyMj1yZXF1aXJlKCcuL2VudGl0aWVzL0JhcjInKTtcblxuaWYgKC9Nb2JpbGUvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKSB7XG4gICAgd2luZG93LmlzTW9iaWxlID0gdHJ1ZTtcbn0gZWxzZSB7XG4gICAgd2luZG93LmlzTW9iaWxlID0gZmFsc2U7XG59XG5cblxud2luZG93Lmg1ID0ge1xuICAgIGluaXRUaHJlZTM2MDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBjYW1lcmEsIHNjZW5lLCByZW5kZXJlcjtcbiAgICAgICAgdmFyIHRleHR1cmVfcGxhY2Vob2xkZXIsXG4gICAgICAgICAgICBpc1VzZXJJbnRlcmFjdGluZyA9IGZhbHNlLFxuICAgICAgICAgICAgb25Nb3VzZURvd25Nb3VzZVggPSAwLFxuICAgICAgICAgICAgb25Nb3VzZURvd25Nb3VzZVkgPSAwLFxuICAgICAgICAgICAgbG9uID0gMCxcbiAgICAgICAgICAgIG9uTW91c2VEb3duTG9uID0gMCxcbiAgICAgICAgICAgIGxhdCA9IDAsXG4gICAgICAgICAgICBvbk1vdXNlRG93bkxhdCA9IDAsXG4gICAgICAgICAgICBwaGkgPSAwLFxuICAgICAgICAgICAgdGhldGEgPSAwLFxuICAgICAgICAgICAgZGlzdGFuY2UgPSA1MDAsXG4gICAgICAgICAgICBvblBvaW50ZXJEb3duUG9pbnRlclggPSAwLFxuICAgICAgICAgICAgb25Qb2ludGVyRG93blBvaW50ZXJZID0gMCxcbiAgICAgICAgICAgIG9uUG9pbnRlckRvd25Mb24gPSAwLFxuICAgICAgICAgICAgb25Qb2ludGVyRG93bkxhdCA9IDA7XG4gICAgICAgIGluaXQoKTtcbiAgICAgICAgLy8gYW5pbWF0ZSgpO1xuXG4gICAgICAgIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICAgICAgICB2YXIgY29udGFpbmVyLCBtZXNoO1xuICAgICAgICAgICAgd2luZG93LmxvYWRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRhaW5lcicpO1xuICAgICAgICAgICAgY2FtZXJhID0gbmV3IFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhKDc1LCB3aW5kb3cuaW5uZXJXaWR0aCAvIHdpbmRvdy5pbm5lckhlaWdodCwgMSwgMTEwMCk7XG4gICAgICAgICAgICBjYW1lcmEudGFyZ2V0ID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMCk7XG4gICAgICAgICAgICBzY2VuZSA9IG5ldyBUSFJFRS5TY2VuZSgpO1xuICAgICAgICAgICAgdmFyIGdlb21ldHJ5ID0gbmV3IFRIUkVFLlNwaGVyZUJ1ZmZlckdlb21ldHJ5KDUwMCwgNjAsIDQwKTtcbiAgICAgICAgICAgIC8vIGludmVydCB0aGUgZ2VvbWV0cnkgb24gdGhlIHgtYXhpcyBzbyB0aGF0IGFsbCBvZiB0aGUgZmFjZXMgcG9pbnQgaW53YXJkXG4gICAgICAgICAgICBnZW9tZXRyeS5zY2FsZSgtMSwgMSwgMSk7XG4gICAgICAgICAgICB2YXIgcGxheV9idG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGxheV9idG4nKTtcbiAgICAgICAgICAgIHZhciB2aWRlbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3ZpZGVvJyk7XG4gICAgICAgICAgICB2aWRlby53aWR0aCA9IDY0MDtcbiAgICAgICAgICAgIHZpZGVvLmhlaWdodCA9IDM2MDtcbiAgICAgICAgICAgIHZpZGVvLmxvb3AgPSB0cnVlO1xuICAgICAgICAgICAgLy8gdmlkZW8ubXV0ZWQgPSB0cnVlO1xuXG4gICAgICAgICAgICAvLyB2aWRlby5zcmMgPSAnaHR0cDovL2ZsaW1zaGF3LmdpdGh1Yi5pby9WYWxpYW50MzYwL3ZpZGVvcy9vdmVycGFzcy0yay5tcDQnO1xuICAgICAgICAgICAgdmlkZW8uc3JjPScuL2Fzc2V0cy9tZWRpYS9zdXJmMS5tcDQnO1xuICAgICAgICAgICAgdmlkZW8uc2V0QXR0cmlidXRlKCd3ZWJraXQtcGxheXNpbmxpbmUnLCAnd2Via2l0LXBsYXlzaW5saW5lJyk7XG4gICAgICAgICAgICB2aWRlby5zZXRBdHRyaWJ1dGUoJ3BsYXlzaW5saW5lJywgJ3BsYXlzaW5saW5lJyk7XG4gICAgICAgICAgICB2aWRlby5zZXRBdHRyaWJ1dGUoJ3g1LXZpZGVvLXBsYXllci1mdWxsc2NyZWVuJywgJ2ZhbHNlJyk7XG4gICAgICAgICAgICB2aWRlby5zZXRBdHRyaWJ1dGUoJ3g1LXZpZGVvLXBsYXllci10eXBlJywgJ2g1Jyk7XG4gICAgICAgICAgICB2aWRlby5zZXRBdHRyaWJ1dGUoJ3gtd2Via2l0LWFpcnBsYXknLCAndHJ1ZScpO1xuICAgICAgICAgICAgdmlkZW8uY3Jvc3NPcmlnaW4gPSBcIkFub255bW91c1wiO1xuXG5cbiAgICAgICAgICAgIC8vIHBsYXlfYnRuLmlubmVySFRNTCA9ICdQbGF5JztcbiAgICAgICAgICAgIHZhciB0ZXh0dXJlID0gbmV3IFRIUkVFLlZpZGVvVGV4dHVyZSh2aWRlbyk7XG4gICAgICAgICAgICB0ZXh0dXJlLm1pbkZpbHRlciA9IFRIUkVFLkxpbmVhckZpbHRlcjtcbiAgICAgICAgICAgIHRleHR1cmUuZm9ybWF0ID0gVEhSRUUuUkdCRm9ybWF0O1xuICAgICAgICAgICAgdmFyIG1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHsgbWFwOiB0ZXh0dXJlIH0pO1xuICAgICAgICAgICAgbWVzaCA9IG5ldyBUSFJFRS5NZXNoKGdlb21ldHJ5LCBtYXRlcmlhbCk7XG4gICAgICAgICAgICBzY2VuZS5hZGQobWVzaCk7XG4gICAgICAgICAgICByZW5kZXJlciA9IG5ldyBUSFJFRS5XZWJHTFJlbmRlcmVyKCk7XG4gICAgICAgICAgICByZW5kZXJlci5zZXRQaXhlbFJhdGlvKHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvKTtcbiAgICAgICAgICAgIHJlbmRlcmVyLnNldFNpemUod2luZG93LmlubmVyV2lkdGgsIHdpbmRvdy5pbm5lckhlaWdodCk7XG4gICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQocmVuZGVyZXIuZG9tRWxlbWVudCk7XG4gICAgICAgICAgICBhbmltYXRlKCk7XG5cblxuICAgICAgICAgICAgcGxheV9idG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwbGF5X2J0bi5pbm5lckhUTUwgPSAnUGxheSc7XG4gICAgICAgICAgICAgICAgaWYgKCF3aW5kb3cubG9hZGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHZpZGVvLnBhdXNlKCk7XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2FkZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZpZGVvLnBsYXkoKTtcbiAgICAgICAgICAgICAgICAgICAgcGxheV9idG4uc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCB0cnVlKTtcbiAgICAgICAgICAgIHZhciBldmVudHN0YXJ0LCBldmVudG1vdmUsIGV2ZW50c3RhcnQ7XG5cbiAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCBmdW5jdGlvbihlKSB7fSwgZmFsc2UpO1xuICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIH0sIGZhbHNlKTtcblxuICAgICAgICAgICAgY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCBvbkRvY3VtZW5Ub3VjaERvd24sIGZhbHNlKTtcbiAgICAgICAgICAgIGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCBvbkRvY3VtZW50VG91Y2hNb3ZlLCBmYWxzZSk7XG4gICAgICAgICAgICBjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCBvbkRvY3VtZW50VG91Y2hVcCwgZmFsc2UpO1xuXG4gICAgICAgICAgICBjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgb25Eb2N1bWVudE1vdXNlRG93biwgZmFsc2UpO1xuICAgICAgICAgICAgY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIG9uRG9jdW1lbnRNb3VzZU1vdmUsIGZhbHNlKTtcbiAgICAgICAgICAgIGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgb25Eb2N1bWVudE1vdXNlVXAsIGZhbHNlKTtcblxuXG4gICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgb25XaW5kb3dSZXNpemUsIGZhbHNlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIG9uV2luZG93UmVzaXplKCkge1xuICAgICAgICAgICAgaWYgKC9Nb2JpbGUvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKSB7XG4gICAgICAgICAgICAgICAgd2luZG93LmlzTW9iaWxlID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgd2luZG93LmlzTW9iaWxlID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYW1lcmEuYXNwZWN0ID0gd2luZG93LmlubmVyV2lkdGggLyB3aW5kb3cuaW5uZXJIZWlnaHQ7XG4gICAgICAgICAgICBjYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpO1xuICAgICAgICAgICAgcmVuZGVyZXIuc2V0U2l6ZSh3aW5kb3cuaW5uZXJXaWR0aCwgd2luZG93LmlubmVySGVpZ2h0KTtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgZnVuY3Rpb24gb25Eb2N1bWVudE1vdXNlRG93bihldmVudCkge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGlzVXNlckludGVyYWN0aW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIG9uUG9pbnRlckRvd25Qb2ludGVyWCA9IGV2ZW50LmNsaWVudFg7XG4gICAgICAgICAgICBvblBvaW50ZXJEb3duUG9pbnRlclkgPSBldmVudC5jbGllbnRZO1xuICAgICAgICAgICAgb25Qb2ludGVyRG93bkxvbiA9IGxvbjtcbiAgICAgICAgICAgIG9uUG9pbnRlckRvd25MYXQgPSBsYXQ7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBvbkRvY3VtZW50TW91c2VNb3ZlKGV2ZW50KSB7XG5cbiAgICAgICAgICAgIGlmIChpc1VzZXJJbnRlcmFjdGluZyA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGxvbiA9IChvblBvaW50ZXJEb3duUG9pbnRlclggLSBldmVudC5jbGllbnRYKSAqIDAuNSArIG9uUG9pbnRlckRvd25Mb247XG4gICAgICAgICAgICAgICAgbGF0ID0gKGV2ZW50LmNsaWVudFkgLSBvblBvaW50ZXJEb3duUG9pbnRlclkpICogMC41ICsgb25Qb2ludGVyRG93bkxhdDtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gb25Eb2N1bWVudE1vdXNlVXAoZXZlbnQpIHtcbiAgICAgICAgICAgIGlzVXNlckludGVyYWN0aW5nID0gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBvbkRvY3VtZW5Ub3VjaERvd24oZXZlbnQpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBpc1VzZXJJbnRlcmFjdGluZyA9IHRydWU7XG4gICAgICAgICAgICBvblBvaW50ZXJEb3duUG9pbnRlclggPSBldmVudC50b3VjaGVzWzBdLmNsaWVudFg7XG4gICAgICAgICAgICBvblBvaW50ZXJEb3duUG9pbnRlclkgPSBldmVudC50b3VjaGVzWzBdLmNsaWVudFk7XG4gICAgICAgICAgICBvblBvaW50ZXJEb3duTG9uID0gbG9uO1xuICAgICAgICAgICAgb25Qb2ludGVyRG93bkxhdCA9IGxhdDtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIG9uRG9jdW1lbnRUb3VjaE1vdmUoZXZlbnQpIHtcblxuICAgICAgICAgICAgaWYgKGlzVXNlckludGVyYWN0aW5nID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgbG9uID0gKG9uUG9pbnRlckRvd25Qb2ludGVyWCAtIGV2ZW50LnRvdWNoZXNbMF0uY2xpZW50WCkgKiAwLjUgKyBvblBvaW50ZXJEb3duTG9uO1xuICAgICAgICAgICAgICAgIGxhdCA9IChldmVudC50b3VjaGVzWzBdLmNsaWVudFkgLSBvblBvaW50ZXJEb3duUG9pbnRlclkpICogMC41ICsgb25Qb2ludGVyRG93bkxhdDtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gb25Eb2N1bWVudFRvdWNoVXAoZXZlbnQpIHtcbiAgICAgICAgICAgIGlzVXNlckludGVyYWN0aW5nID0gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBhbmltYXRlKCkge1xuICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpO1xuICAgICAgICAgICAgdXBkYXRlKCk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiB1cGRhdGUoKSB7XG4gICAgICAgICAgICBsYXQgPSBNYXRoLm1heCgtODUsIE1hdGgubWluKDg1LCBsYXQpKTtcbiAgICAgICAgICAgIHBoaSA9IFRIUkVFLk1hdGguZGVnVG9SYWQoOTAgLSBsYXQpO1xuICAgICAgICAgICAgdGhldGEgPSBUSFJFRS5NYXRoLmRlZ1RvUmFkKGxvbik7XG4gICAgICAgICAgICBjYW1lcmEucG9zaXRpb24ueCA9IGRpc3RhbmNlICogTWF0aC5zaW4ocGhpKSAqIE1hdGguY29zKHRoZXRhKTtcbiAgICAgICAgICAgIGNhbWVyYS5wb3NpdGlvbi55ID0gZGlzdGFuY2UgKiBNYXRoLmNvcyhwaGkpO1xuICAgICAgICAgICAgY2FtZXJhLnBvc2l0aW9uLnogPSBkaXN0YW5jZSAqIE1hdGguc2luKHBoaSkgKiBNYXRoLnNpbih0aGV0YSk7XG4gICAgICAgICAgICBjYW1lcmEubG9va0F0KGNhbWVyYS50YXJnZXQpO1xuICAgICAgICAgICAgLypcbiAgICAgICAgICAgIC8vIGRpc3RvcnRpb25cbiAgICAgICAgICAgIGNhbWVyYS5wb3NpdGlvbi5jb3B5KCBjYW1lcmEudGFyZ2V0ICkubmVnYXRlKCk7XG4gICAgICAgICAgICAqL1xuICAgICAgICAgICAgcmVuZGVyZXIucmVuZGVyKHNjZW5lLCBjYW1lcmEpO1xuICAgICAgICB9XG5cbiAgICB9LFxuICAgIGluaXRWYWxpYW50MzYwOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHBsYXlfYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BsYXlfYnRuJyk7XG4gICAgICAgICQoJy52YWxpYW50Q29udGFpbmVyJykuVmFsaWFudDM2MCgpO1xuICAgICAgICBwbGF5X2J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy8gcGxheVxuICAgICAgICAgICAgJCgnLnZhbGlhbnRDb250YWluZXInKS5WYWxpYW50MzYwKCdwbGF5Jyk7XG4gICAgICAgICAgICAkKCcudmFsaWFudENvbnRhaW5lcicpLlZhbGlhbnQzNjAoJ3BhdXNlJyk7XG4gICAgICAgIH0sIGZhbHNlKTtcbiAgICAgICAgJCgnLnZhbGlhbnRDb250YWluZXInKS5WYWxpYW50MzYwKCdsb2FkVmlkZW8nLCAnLi9hc3NldHMvbWVkaWEvY2l0eS5tcDQnKTtcbiAgICAgICAgJCgnLnZhbGlhbnRDb250YWluZXInKS5WYWxpYW50MzYwKCdwbGF5Jyk7XG4gICAgICAgIC8vICQoJy52YWxpYW50Q29udGFpbmVyJykuVmFsaWFudDM2MCgncGF1c2UnKTtcblxuICAgIH0sXG4gICAgcm9vdFJlc2l6ZTI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAvL29yaWVudGF0aW9uIGxhbmRzY2FwZSB3aWR0aD0xMzM0cHhcbiAgICAgICAgdmFyIHdGc2l6ZTtcbiAgICAgICAgdmFyIHdXaWR0aCA9IChzY3JlZW4ud2lkdGggPiAwKSA/ICh3aW5kb3cuaW5uZXJXaWR0aCA+PSBzY3JlZW4ud2lkdGggfHwgd2luZG93LmlubmVyV2lkdGggPT0gMCkgPyBzY3JlZW4ud2lkdGggOlxuICAgICAgICAgICAgd2luZG93LmlubmVyV2lkdGggOiB3aW5kb3cuaW5uZXJXaWR0aDtcbiAgICAgICAgdmFyIHdIZWlnaHQgPSAoc2NyZWVuLmhlaWdodCA+IDApID8gKHdpbmRvdy5pbm5lckhlaWdodCA+PSBzY3JlZW4uaGVpZ2h0IHx8IHdpbmRvdy5pbm5lckhlaWdodCA9PSAwKSA/XG4gICAgICAgICAgICBzY3JlZW4uaGVpZ2h0IDogd2luZG93LmlubmVySGVpZ2h0IDogd2luZG93LmlubmVySGVpZ2h0O1xuICAgICAgICBpZiAod1dpZHRoID4gd0hlaWdodCkge1xuICAgICAgICAgICAgd0hlaWdodCA9IHdXaWR0aDtcbiAgICAgICAgfVxuICAgICAgICB3RnNpemUgPSB3SGVpZ2h0IC8gMTMuMzQ7XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdodG1sJylbMF0uc3R5bGUuZm9udFNpemUgPSB3RnNpemUgKyAncHgnO1xuICAgIH0sXG4gICAgcm9vdFJlc2l6ZTE6IGZ1bmN0aW9uKCkge1xuICAgICAgICAvL29yaWVudGF0aW9uIGxhbmRzY2FwZSB3aWR0aD0xMzM0cHhcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgRHByID0gMSxcbiAgICAgICAgICAgIHVBZ2VudCA9IHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50O1xuICAgICAgICB2YXIgaXNJT1MgPSB1QWdlbnQubWF0Y2goL2lwaG9uZS9pKTtcbiAgICAgICAgdmFyIGlzWUlYSU4gPSB1QWdlbnQubWF0Y2goL3lpeGluL2kpO1xuICAgICAgICB2YXIgaXMyMzQ1ID0gdUFnZW50Lm1hdGNoKC9NYjIzNDUvaSk7XG4gICAgICAgIHZhciBpc2hhb3NvdSA9IHVBZ2VudC5tYXRjaCgvbXNvX2FwcC9pKTtcbiAgICAgICAgdmFyIGlzU29nb3UgPSB1QWdlbnQubWF0Y2goL3NvZ291bW9iaWxlYnJvd3Nlci9pZyk7XG4gICAgICAgIHZhciBpc0xpZWJhbyA9IHVBZ2VudC5tYXRjaCgvbGllYmFvZmFzdC9pKTtcbiAgICAgICAgdmFyIGlzR25iciA9IHVBZ2VudC5tYXRjaCgvR05CUi9pKTtcbiAgICAgICAgdmFyIGlzV2VpeGluID0gdUFnZW50Lm1hdGNoKC9NaWNyb01lc3Nlbmdlci9pKTtcbiAgICAgICAgdmFyIHdGc2l6ZTtcbiAgICAgICAgdmFyIHdXaWR0aCA9IChzY3JlZW4ud2lkdGggPiAwKSA/ICh3aW5kb3cuaW5uZXJXaWR0aCA+PSBzY3JlZW4ud2lkdGggfHwgd2luZG93LmlubmVyV2lkdGggPT0gMCkgPyBzY3JlZW4ud2lkdGggOlxuICAgICAgICAgICAgd2luZG93LmlubmVyV2lkdGggOiB3aW5kb3cuaW5uZXJXaWR0aDtcbiAgICAgICAgdmFyIHdIZWlnaHQgPSAoc2NyZWVuLmhlaWdodCA+IDApID8gKHdpbmRvdy5pbm5lckhlaWdodCA+PSBzY3JlZW4uaGVpZ2h0IHx8IHdpbmRvdy5pbm5lckhlaWdodCA9PSAwKSA/XG4gICAgICAgICAgICBzY3JlZW4uaGVpZ2h0IDogd2luZG93LmlubmVySGVpZ2h0IDogd2luZG93LmlubmVySGVpZ2h0O1xuICAgICAgICBpZiAoaXNJT1MpIHtcbiAgICAgICAgICAgIHdXaWR0aCA9IHNjcmVlbi53aWR0aDtcbiAgICAgICAgICAgIHdIZWlnaHQgPSBzY3JlZW4uaGVpZ2h0O1xuICAgICAgICB9XG4gICAgICAgIGlmICh3V2lkdGggPiB3SGVpZ2h0KSB7XG4gICAgICAgICAgICB3SGVpZ2h0ID0gd1dpZHRoO1xuICAgICAgICB9XG4gICAgICAgIHdGc2l6ZSA9IHdIZWlnaHQgLyAxMy4zNDtcbiAgICAgICAgaWYgKGlzWUlYSU4gfHwgaXMyMzQ1IHx8IGlzaGFvc291IHx8IGlzU29nb3UgfHwgaXNMaWViYW8gfHwgaXNHbmJyIHx8IGlzV2VpeGluKSB7IC8vWUlYSU4g5ZKMIDIzNDUg6L+Z6YeM5pyJ5Liq5Yia6LCD55So57O757uf5rWP6KeI5Zmo5pe25YCZ55qEYnVn77yM6ZyA6KaB5LiA54K55bu26L+f5p2l6I635Y+WXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHdIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCB8fCBkb2N1bWVudC5ib2R5LmNsaWVudEhlaWdodDtcbiAgICAgICAgICAgICAgICB3V2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggfHwgZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aDtcbiAgICAgICAgICAgICAgICBpZiAod1dpZHRoID4gd0hlaWdodCkge1xuICAgICAgICAgICAgICAgICAgICB3SGVpZ2h0ID0gd1dpZHRoO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB3RnNpemUgPSB3SGVpZ2h0IC8gMTMuMzQ7XG4gICAgICAgICAgICAgICAgLy8gd0ZzaXplID0gd0ZzaXplID4gMzIgPyB3RnNpemUgOiAzMjtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaHRtbCcpWzBdLnN0eWxlLmZvbnRTaXplID0gd0ZzaXplICsgJ3B4JztcbiAgICAgICAgICAgIH0sIDUwMCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaHRtbCcpWzBdLnN0eWxlLmZvbnRTaXplID0gd0ZzaXplICsgJ3B4JztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGF0O1xuXG4gICAgfSxcbiAgICBldmVudEluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCBmdW5jdGlvbihlKSB7fSwgZmFsc2UpO1xuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH0sIGZhbHNlKTtcbiAgICAgICAgcmV0dXJuIHRoYXQ7XG4gICAgfSxcbiAgICBjc3NJbml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICAvKlxuICAgICAgICB0aGF0LnJvb3RSZXNpemUxKCk7XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwib25vcmllbnRhdGlvbmNoYW5nZVwiIGluIHdpbmRvdyA/IFwib3JpZW50YXRpb25jaGFuZ2VcIiA6IFwicmVzaXplXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHdpbmRvdy5vcmllbnRhdGlvbiA9PSA5MCB8fCB3aW5kb3cub3JpZW50YXRpb24gPT0gLTkwKSB7XG4gICAgICAgICAgICAgICAgLy/mqKrlsY9cbiAgICAgICAgICAgICAgICAvL18ucmVuZGVyU2h1cGluZygpO1xuICAgICAgICAgICAgICAgIHRoYXQucm9vdFJlc2l6ZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvL+erluWxj1xuICAgICAgICAgICAgICAgIC8vXy5jbG9zZVNodXBpbmcoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgZmFsc2UpO1xuICAgICAgICAqL1xuICAgICAgICB2YXIgbm9DaGFuZ2VDb3VudFRvRW5kID0gMTAwLFxuICAgICAgICAgICAgbm9FbmRUaW1lb3V0ID0gMTAwMDtcbiAgICAgICAgdGhhdC5yb290UmVzaXplMigpO1xuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcIm9ub3JpZW50YXRpb25jaGFuZ2VcIiBpbiB3aW5kb3cgPyBcIm9yaWVudGF0aW9uY2hhbmdlXCIgOiBcInJlc2l6ZVwiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBpbnRlcnZhbCxcbiAgICAgICAgICAgICAgICB0aW1lb3V0LFxuICAgICAgICAgICAgICAgIGVuZCxcbiAgICAgICAgICAgICAgICBsYXN0SW5uZXJXaWR0aCxcbiAgICAgICAgICAgICAgICBsYXN0SW5uZXJIZWlnaHQsXG4gICAgICAgICAgICAgICAgbm9DaGFuZ2VDb3VudDtcbiAgICAgICAgICAgIGVuZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIC8vIFwib3JpZW50YXRpb25jaGFuZ2VlbmRcIlxuICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpO1xuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcbiAgICAgICAgICAgICAgICBpbnRlcnZhbCA9IG51bGw7XG4gICAgICAgICAgICAgICAgdGltZW91dCA9IG51bGw7XG4gICAgICAgICAgICAgICAgdGhhdC5yb290UmVzaXplMSgpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGludGVydmFsID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5pbm5lcldpZHRoID09PSBsYXN0SW5uZXJXaWR0aCAmJiB3aW5kb3cuaW5uZXJIZWlnaHQgPT09IGxhc3RJbm5lckhlaWdodCkge1xuICAgICAgICAgICAgICAgICAgICBub0NoYW5nZUNvdW50Kys7XG4gICAgICAgICAgICAgICAgICAgIGlmIChub0NoYW5nZUNvdW50ID09PSBub0NoYW5nZUNvdW50VG9FbmQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZSBpbnRlcnZhbCByZXNvbHZlZCB0aGUgaXNzdWUgZmlyc3QuXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmQoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGxhc3RJbm5lcldpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XG4gICAgICAgICAgICAgICAgICAgIGxhc3RJbm5lckhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcbiAgICAgICAgICAgICAgICAgICAgbm9DaGFuZ2VDb3VudCA9IDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAvLyBUaGUgdGltZW91dCBoYXBwZW5lZCBmaXJzdC5cbiAgICAgICAgICAgICAgICBlbmQoKTtcbiAgICAgICAgICAgIH0sIG5vRW5kVGltZW91dCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB0aGF0O1xuICAgIH1cbn07XG53aW5kb3cuaDUuaW5pdFRocmVlMzYwKCk7XG4vLyB3aW5kb3cuaDUuaW5pdFZhbGlhbnQzNjAoKTtcbi8vIHdpbmRvdy5oNS5jc3NJbml0KCkuZXZlbnRJbml0KCk7XG5cblxuZnVuY3Rpb24gc2hvd1N0YXRzKCkge1xuICAgIHZhciBzdGF0cyA9IG5ldyBTdGF0cygpO1xuICAgIHN0YXRzLnNob3dQYW5lbCgwKTsgLy8gMDogZnBzLCAxOiBtcywgMjogbWIsIDMrOiBjdXN0b21cbiAgICB2YXIgZnMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBmcy5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7XG4gICAgZnMuc3R5bGUubGVmdCA9IDA7XG4gICAgZnMuc3R5bGUudG9wID0gMDtcbiAgICBmcy5zdHlsZS56SW5kZXggPSA5OTk7XG4gICAgZnMuYXBwZW5kQ2hpbGQoc3RhdHMuZG9tRWxlbWVudCk7XG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChmcyk7XG5cbiAgICBmdW5jdGlvbiBhbmltYXRlKCkge1xuICAgICAgICBzdGF0cy5iZWdpbigpO1xuICAgICAgICAvLyBtb25pdG9yZWQgY29kZSBnb2VzIGhlcmVcbiAgICAgICAgc3RhdHMuZW5kKCk7XG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTtcbiAgICB9XG4gICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpO1xufVxuc2hvd1N0YXRzKCk7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9zcmMvYXNzZXRzL2pzL21haW4uanNcbi8vIG1vZHVsZSBpZCA9IDBcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiLy8gcmVtb3ZlZCBieSBleHRyYWN0LXRleHQtd2VicGFjay1wbHVnaW5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL3NyYy9hc3NldHMvY3NzL2Nzcy5jc3Ncbi8vIG1vZHVsZSBpZCA9IDFcbi8vIG1vZHVsZSBjaHVua3MgPSAwIl0sInNvdXJjZVJvb3QiOiIifQ==